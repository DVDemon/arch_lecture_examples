# 2. Репликация хранилища данных на PostgreSQL

Date: 2023-06-06

## Status

Accepted

## Context

Для обеспечения обработки большого количества запросов на чтение данных необходимо разработать стратегию масштабирования хранилища на PostgreSQL

## Decision

Рассматриваемые варианты:
1. Построение репликации Master-Slave
2. Построение кеширующего слоя на Redis

**Плюсы решения 1:**
Возможность перенаправлять запросы "чисто на чтение" к Slave реплике, снижая нагрузку на master. Возможность увеличивать количество Slave реплик.

**Минусы решения 1:**
При увеличении числа запросов на запись такая тактика не поможет снять нагрузку

**Плюсы решения 2:**
При реализации паттернов "сквозное чтение" и "сквозная запись" кластер Redis может помочь снизить нагрузку на систему хранения в PostgreSQL, если в нем сохранять копии основных данных.

**Минусы решения 2:**
Есть вероятность того что не получится подобрать оптимальную стратегию кеширования (будет много cache-miss). Не очевидна оптимальная стартегия прогрева кеша.

**Выбирается решение 1**

## Consequences
Для обеспечения отказоустойчивости необходимо отдельно разворачивать кластер на patroni и осуществить настройку синхронной репликации.
На стороне бизнес-логики нужно поддержать разделение запросов на чтение и записиь и обеспечить обращение к разным репликам.